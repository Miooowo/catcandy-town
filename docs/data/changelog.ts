export interface ChangelogEntry {
  version: string;
  title?: string; // 版本标题
  date: string;
  added?: string[];
  removed?: string[];
  changed?: string[];
  fixed?: string[];
}

export const GAME_VERSION = '1.6';

// 秘籍文本加密函数（生成乱码效果，类似"棍斤拷"）
const encryptSecret = (text: string): string => {
  // 秘籍部分需要加密的字符映射
  const secretPart = '↑↑↓↓←→←→BABA';
  
  // 使用生僻字和乱码字符替换秘籍部分
  // 模拟编码错误产生的乱码效果（类似"棍斤拷"）
  const garbledSequence = '棍斤拷烫烫烫锟斤拷烫烫烫';
  
  // 找到秘籍部分并替换为乱码
  const secretIndex = text.indexOf(secretPart);
  if (secretIndex !== -1) {
    const before = text.substring(0, secretIndex);
    const after = text.substring(secretIndex + secretPart.length);
    // 使用乱码序列替换秘籍
    return before + garbledSequence + after;
  }
  
  // 如果没有找到完整秘籍，对单个字符进行替换
  const charMap: Record<string, string> = {
    '↑': '棍',
    '↓': '斤',
    '←': '拷',
    '→': '烫',
    'B': '锟',
    'A': '烫'
  };
  
  return text.split('').map(char => charMap[char] || char).join('');
};

export const CHANGELOG: ChangelogEntry[] = [
  {
    version: '1.6',
    title: '洗脚店之夜！',
    date: '2025/11/22',
    added: [
      '存档淫乱度系统：在开始页添加淫乱度选择（0-10级），影响全局淫乱属性',
      '纯爱模式（0级淫乱度）：取消所有炮友和小三关系，强碱和诱拐概率为0',
      '高淫乱度（10级）：增加70%的淫乱属性修正',
      '死宅特质：新增死宅特质，死宅几乎不买避孕用品，不去酒吧喝酒，几乎总是待在家里，通过鹿观或扣扣释放性欲',
      '喝醉酒打劫事件：喝醉酒的人有概率进行打劫，如果对方拒不付钱或身无分文则进行劫色判定'
    ],
    changed: [
      '降低全局淫乱属性：整体降低游戏中的淫乱相关行为概率',
      '修正胆小特质：胆小特质的人更少或几乎不买避孕套',
      '优化性欲系统：死宅特质也有性欲值，通过在家进行鹿观或扣扣释放',
      '关系网络优化：取消关系网络的物理效果，改为静态显示，节点位置固定，仍支持手动拖拽和缩放'
    ],
    fixed: [
      '修复教堂收入记录问题：教堂的门槛费和结婚费用现在正确记录日均收入'
    ]
  },
  {
    version: '1.5.3',
    date: '2025/11/22 12:57',
      added: [
        '调试面板：新增调试菜单功能，可在游戏内快速跳天数（5/10/14/30/60/90/180/360天）',
        encryptSecret('秘籍系统：输入秘籍 ↑↑↓↓←→←→BABA 可解锁调试面板，并显示精美的秘籍弹窗'),
        '游戏日志指令：在游戏日志面板添加指令输入框，支持 （该指令已加密隐藏） 指令启用调试模式',
        '调试按钮优化：调试按钮初始隐藏，切换存档或新建游戏时自动隐藏'
      ],
    changed: [
      'UI优化：将手机端侧边栏按钮移到城镇名称左边',
      '旁观者名显示：在版本信息旁边显示旁观者名，点击铅笔图标可编辑',
      '重置按钮移至侧边栏：重置按钮改名为"全局重置"并移至侧边栏',
      '存档重roll功能：新增存档重roll按钮，可重新随机生成居民特质并重置游戏时间'
    ]
  },
  {
    version: '1.5.2',
    date: '2025/11/22 11:19',
    added: [
      '喝晕后可以带回家照顾或发生关系：带回家照顾会增加彼此好感',
      '发生关系的好感度影响：被发生方非淫乱特质发生关系会降低发生者的好感',
      '淫乱特质的好感度影响：淫乱特质的被发生关系也有小的概率降低对方的好感，也有概率发展成炮友',
      '机智特质：机智特质可以和偷懒、喜欢睡觉一起出现，拥有机智特质的摸鱼者更难被老板抓到',
      '榜单功能：将榜单从主页移到存档游戏内，可以在游戏内查看各种排行榜'
    ],
    changed: [
      '页面布局优化：将建筑列表放在左侧边栏，游戏日志放在界面下方'
    ],
    fixed: [
      '修正喝晕被带回家后又被其他人带到酒店的bug：如果a喝晕被b带回家，那么c就不能把a带到酒店',
      '修正摸鱼被开除后没有辞退冷却的bug：现在被开除辞退后会像主动辞职者一样进入工作冷却期'
    ]
  },
  {
    version: '1.5.1',
    date: '2025/11/22 8:53',
    fixed: [
      '修复友谊关系显示：陌生人关系不再显示在友谊关系中'
    ]
  },
  {
    version: '1.5',
    date: '2025/11/22 8:46',
    added: [
      '家庭大更新：孩子会随父母姓，姓氏通常是名字的第一个字开头',
      '特质遗传：孩子会概率获得父母拥有的特质，获得1个到4个的概率为：70%，60%，10%，2%',
      '亲属关系显示：可以在居民的档案信息里查看居民的亲属关系（父母、子女、兄弟姐妹）',
      '族谱功能：在关系谱中添加族谱，点击族谱可以查看城镇内各个居民的家庭树'
    ],
    changed: [
      '优化家庭系统：完善了家庭关系的展示和追踪'
    ]
  },
  {
    version: '1.4.1',
    date: '2025/11/22',
    added: [
      '教堂门槛费：进入教堂需要200元门槛费，神父获得90%，10%用来升级教堂',
      '结婚费用：等级结婚时进入教堂不需要门槛费，但需要办理结婚费用300元，神父获得90%，10%用来升级教堂',
      '零花钱机制：1到17岁的孩子可以获得来自父母的零花钱，零花钱从父母的账户里扣除'
    ],
    changed: [
      '修正孩子年龄：刚出生为1岁（之前为0岁）',
      '年龄限制：1到17岁不可以去站街或者卖银，也不可以参与任何工作，不可以喝酒也不可以去买银'
    ]
  },
  {
    version: '1.4',
    date: '2025/11/22 8:21',
    added: [
      '抢劫系统：当居民财富远高于其他居民时，会增加被抢劫的概率',
      '抢劫金额：被抢劫的金额为1%到10%不等',
      '抢劫判定：易怒且小气的人更不容易被抢劫，爱钱且无业的人更容易去抢劫',
      '胆小特质：新增胆小特质，胆小的人害怕被草，抗拒酒店，成为炮友可能性更低，喝酒通常不会喝晕',
      '特质冲突：勤奋和喜欢睡觉不能同时存在'
    ],
    changed: [
      '将游戏内的"特性"改为"特质"（UI显示）',
      '加强胆小特质：胆小的人在得知要去酒店挨操的时候会更加抗拒',
      '加强胆小特质：胆小的人成为炮友的可能性比其他人更低',
      '加强胆小特质：胆小的人因为不善社交也害怕被操',
      '加强胆小特质：胆小的人喝酒通常不会喝晕'
    ]
  },
  {
    version: '1.3.1',
    date: '2025/11/22',
    added: [
      '居民卡片和档案显示年龄信息',
      '医院建筑详情显示医疗服务（堕胎手术、分娩手术）',
      '药店建筑详情显示药品售卖（避孕药、避孕贴、避孕套）'
    ],
    changed: [
      '更新"猫の星空登陆舱"预设：添加初始居民"湫白"，移除"哈基米"',
      '优化建筑详情显示：为不同建筑类型显示对应的商品/服务标题'
    ]
  },
  {
    version: '1.3',
    date: '2025/11/22 7:31',
    added: [
      '寿命和人口流动机制：初始居民年龄在18-40岁之间随机生成，普通情况下人最多活100岁',
      '医院医疗服务：堕胎手术1000元，分娩手术3000元，居民需要时会去医院做手术',
      '药店避孕药品：避孕药103元一盒20个，避孕贴75元一个，避孕套40元一盒12个',
      '分娩和堕胎机制：优先去医院，如果医院没建成则在家中分娩或堕胎，在日志中显示',
      '人口流失机制：如果城镇人口过多（>100时），多余的人口可能因为幸福感机制而流失',
      '城镇幸福感机制：如果居民对城镇生活感到不幸福，则会有较低概率辞职工作并离开城镇',
      '旁观者名称：在开始页添加自定义旁观者名称，多人模式下显示"旁观者名 的 城镇名"'
    ],
    changed: [
      '优化多人模式显示：查看其他城镇和居民所在城镇都显示"旁观者名 的 城镇名"格式'
    ]
  },
  {
    version: '1.2.1',
    date: '2025/11/22 7:00',
    added: [
      '查看其他城镇居民信息：在联机列表中点击其他城镇可以查看该城镇的所有居民信息',
      '居民详情显示：显示居民的金钱、幸福度、当前行动和所在城镇'
    ],
    fixed: [
      '修复断开连接后重新连接时自己不在房间列表的问题',
      '优化城镇恢复机制：重新连接时自动恢复之前的城镇'
    ]
  },
  {
    version: '1.2',
    date: '2025/11/22',
    added: [
      '多人联机模式：支持多个玩家同时游戏，每个玩家拥有自己的城镇',
      '跨城镇交互：居民可以前往其他城镇消费（如酒店、酒吧等）',
      '跨城镇收入：其他城镇的居民在你的城镇消费会带来收入',
      '城镇列表：可以查看所有在线城镇及其建筑信息',
      '角色旅行状态：角色卡片显示当前所在城镇（多人模式）'
    ],
    changed: [
      '优化角色行为：喜欢睡觉的居民会优先前往有酒店的城镇',
      '优化多人体验：角色卡片显示跨城镇旅行状态'
    ]
  },
  {
    version: '1.1',
    date: '2025/11/22 4:33',
    added: [
      '多存档槽位系统：支持多个存档槽位，方便管理不同游戏进度',
      '存档页面：在开始游戏前可以选择存档槽位',
      '预设功能：支持通过群号快速加载预设的城镇和居民配置'
    ],
    changed: [
      '优化存档系统：旧存档自动迁移到存档槽位1'
    ]
  },
  {
    version: '1.0.2',
    date: '2025/11/22 4:15',
    changed: [
      '优化开始界面：加深城镇名称和居民名称颜色，提升可读性',
      '优化时间速度调节：加深输入框内数字颜色',
      '移除游戏内自定义按钮（可在开始界面设置）'
    ]
  },
  {
    version: '1.0.1.2',
    date: '2025/11/22 4:08',
    changed: [
      '修复了游戏重置功能，现在可以正确重置游戏状态'
    ]
  },
  {
    version: '1.0.1.1',
    date: '2025/11/21 21:00',
    changed: [
      '优化游戏初始化流程：自定义界面在游戏开始前运行',
      '玩家需要先完成城镇和居民设置后才能开始游戏'
    ]
  },
  {
    version: '1.0.1',
    date: '2025-11-21 20:52',
    added: [
      '自定义城镇名称：玩家可以为自己的小镇命名',
      '自定义初始居民：玩家可以在自定义界面查看和命名12个初始居民',
      '自定义界面：新增专门的设置界面，方便管理城镇和居民名称'
    ]
  },
  {
    version: '1.0.0',
    date: '2025-11-21',
    added: [
      '游戏初始版本发布',
      '居民系统：支持角色创建、性格设定、特性系统',
      '建筑系统：支持建筑建设、升级、营业时间管理',
      '关系系统：支持友谊、恋爱、婚姻等复杂人际关系',
      '工作系统：支持角色就业、收入统计',
      '日志系统：实时记录游戏事件',
      '存档系统：支持游戏进度保存和加载',
      '暗色模式：支持亮色/暗色主题切换',
      '移动端适配：优化手机浏览器显示效果'
    ]
  }
];

